<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 客家故事互動繪本 - 魚藤坪與龍騰斷橋</title>
    <style>
        
        body {
            background-color: #E0FFFF;
            font-family: '微軟正黑體', 'Microsoft JhengHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #FFFFFF;
            padding: 20px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #0056b3;
            border-bottom: 3px solid #E0FFFF;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border: 5px solid #ccc;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .caption {
            font-size: 1.5em;
            line-height: 1.8;
            min-height: 50px;
        }

        .hakkaword {
            color: #CC0000;
            font-weight: bold;
            cursor: pointer;
            padding: 2px 0;
            border-bottom: 2px dashed #CC0000;
            transition: color 0.2s;
        }

        .hakkaword:hover {
            color: #FF6347;
        }
        
        .page-indicator {
            margin-top: 30px;
            font-size: 1.1em;
            color: #666;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>客家故事：AI 數位繪本 - 魚藤坪與龍騰斷橋</h1>

    <div class="image-container">
        <img id="bookImage" src="images/image1.png" alt="繪本插畫" onerror="this.src='images/placeholder.png';" />
    </div>

    <div id="captionText" class="caption">
        </div>
    
    <div class="page-indicator">
        <span id="pageNumber">1</span> / 8頁 | 按 **[空白鍵]** 換下一頁
    </div>

</div>

<script>
    // =================================================
    // JavaScript 邏輯
    // =================================================

    const bookData = [
        // 頁面 01
        { image: 'images/image1.png', caption: '<span id="w01" data-word-id="1" class="hakkaword">先民</span>來到魚藤坪開墾，定居落來。', },
        // 頁面 02
        { image: 'images/image2.png', caption: '<span id="w02" data-word-id="2" class="hakkaword">鯉魚潭</span>肚个鯉魚精，時常出來食掉村民个頭牲。', },
        // 頁面 03
        { image: 'images/image3.png', caption: '<span id="w03" data-word-id="3" class="hakkaword">地理先生</span>來指點，用魚藤、關刀趕走鯉魚精。', },
        // 頁面 04
        { image: 'images/image4.png', caption: '橋身用紅磚砌成，看起來有<span id="w04" data-word-id="4" class="hakkaword">歐洲風情</span>。', },
        // 頁面 05
        { image: 'images/image5.png', caption: '後來關刀山<span id="w05" data-word-id="5" class="hakkaword">大地動</span>，橋面全壞了。', },
        // 頁面 06
        { image: 'images/image6.png', caption: '<span id="w06" data-word-id="6" class="hakkaword">勝利車站</span>用福州站建材，係用鑿榫設計个。', },
        // 頁面 07
        { image: 'images/image7.png', caption: '屋頂還有<span id="w07" data-word-id="7" class="hakkaword">烏鴉</span>，聽說是保平安个法器。', },
        // 頁面 08
        { image: 'images/image8.png', caption: '老車頭經過大地動，還係<span id="w08" data-word-id="8" class="hakkaword">完好無損</span>呢', },
    ];

    let currentPage = 0; // 索引從 0 開始，代表第一頁
    const totalPages = bookData.length;
    const bookImage = document.getElementById('bookImage');
    const captionText = document.getElementById('captionText');
    const pageNumberDisplay = document.getElementById('pageNumber');
    
    let keywordAudio = new Audio();
    // 設置錯誤處理：這是診斷音檔問題的關鍵
    keywordAudio.onerror = (e) => console.error("音檔載入失敗！請確認檔案路徑/格式:", keywordAudio.src, e);


    function loadPage(pageIndex) {
        if (keywordAudio) {
            keywordAudio.pause();
            keywordAudio.currentTime = 0;
        }

        if (pageIndex >= 0 && pageIndex < totalPages) {
            const data = bookData[pageIndex];
            
            // 嘗試載入圖片
            bookImage.src = data.image; 
            
            captionText.innerHTML = data.caption;
            pageNumberDisplay.textContent = pageIndex + 1;
            bindKeywordEvents();
        } else if (pageIndex === totalPages) {
            // 故事結束頁
            captionText.innerHTML = '✨ 故事結束！感謝聆聽。 ✨';
            pageNumberDisplay.textContent = totalPages;
            
        }
        currentPage = pageIndex;
    }
    
    function playAudioFragment(event) {
        const keywordElement = event.target.closest('.hakkaword');
        if (!keywordElement) return;

        if (keywordAudio) {
             keywordAudio.pause();
             keywordAudio.currentTime = 0;
        }

        const wordId = keywordElement.dataset.wordId; 
        if (!wordId) return;

        
        const audioPath = `recordings/${wordId}.MP3`; 

        keywordAudio.src = audioPath;
        keywordAudio.play().catch(error => {
             console.error(`無法播放單字音檔 (${audioPath})，請檢查檔案:`, error);
        });
    }
    
    function bindKeywordEvents() {
        const keywords = document.querySelectorAll('.hakkaword');
        keywords.forEach(word => {
            word.removeEventListener('click', playAudioFragment); 
            word.addEventListener('click', playAudioFragment);
        });
    }

    document.addEventListener('keydown', (event) => {
        if (event.code === 'Space' || event.key === ' ') {
            event.preventDefault(); 
            
            if (currentPage < totalPages) {
                loadPage(currentPage + 1);
            }
        }
    });

    // --- 啟動時直接載入第一頁 (索引 0) ---
    loadPage(0); 
</script>

</body>
</html>